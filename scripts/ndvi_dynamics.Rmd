---
title: "NDVI Peak Dynamics"
author: "Robert Paul, Jeff Stephens"
date: "June 23, 2016"
output: html_document
---
# NDVI Peak Dynamics

This workflow detects the length of time for NDVI to go from baseline to peak over the course of the year. Each pixel is classified with a value reflecting the length of time in the year for NDVI to reach peak greenness.

Notes:
 * Allow options for baseline-to-peak or baseline-to-baseline
 * Site: Harvard Forest
 * UTM Zone 18T
 * Data sources: MODIS (primary), Landsat 8
 * First year used: 2012
 * MODIS product: MOD13Q1
 * MODIS tile: h12v4

## Load libraries
```{r load-libraries}
library(raster)
library(rgdal)
library(rts)
library(RCurl)
```

## Create functions
```{r functions}

```

## Load rasters
```{r load-rasters}
# Download the data if it's not found
if(length(dir("/data")) == 0) {
  # Move to the data directory
  setwd("data")
  # ***Change this to where MRT is installed!
  mrt_path <- "/Users/exnihilo/Applications/bin/"
  # ***Change to where the MRT application data folder is!
  Sys.setenv(MRT_DATA_DIR="/Users/exnihilo/Applications/data/")
  # NDVI and EVI are bands 1 and 2 of 12
  getBands <- c(1, 1, rep(0, 10))
  # bands_subset weirdly expects a single string--"1 1 0 0 0..."
  getBands <- paste(getBands, collapse = " ")
  # Download MODIS data and reproject it to UTM 18
  ModisDownload(x = 1,
                h = 12,
                v = 4,
                dates=c("2012.01.01", "2012.12.30"),
                proj=T,
                proj_type="UTM",
                utm_zone=18,
                datum="WGS84",
                pixel_size=250,
                bands_subset = getBands,
                MRTpath= mrt_path)
  # Move back to the root working directory
  setwd("../")
}

# EVI and NDVI files for the year are moved in their own directory
# e.g. EVI files for 2012 are in data/2012/evi

ndvi_files <- list.files("data/2012/ndvi", full.names=TRUE)
r <- stack(ndvi_files)
dates <- as.Date(substr(ndvi_files, 16, 25))
ndvi_ts <- rts(r, dates)

```

## Make an ordered time series of the rasters
```{r time-series-stack}

```

## Handle clouds
```{r handle-clouds}

```

## Trace/describe NDVI over the year
```{r track-ndvi}

```

## Reclassify the raster based on the NDVI dynamics detected
```{r reclass-based-on-time-series}

```

## Plot the reclassified raster
```{r plot-result}

```

## Show animation of raster
```{r animate-changes}

```
